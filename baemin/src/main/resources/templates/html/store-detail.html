<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title th:text="${store.storeName} + ' - 배민'">가게 상세</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" th:href="@{/css/store-detail.css}">
</head>
<body>
    <div class="main-container">
        <!-- 상단 헤더 -->
        <div class="store-header">
            <div class="header-content">
                <button class="back-btn" onclick="history.back()">←</button>
                <div class="store-title">
                    <div class="store-name" th:text="${store.storeName}">가게명</div>
                    <div class="store-category">중식</div>
                </div>
                <div class="header-info">
                    <div th:text="${'₩' + #numbers.formatInteger(store.minimumPrice, 1, 'COMMA')}">₩10,000</div>
                    <div th:text="'리뷰 ' + ${store.reviewCount}">리뷰 24</div>
                </div>
            </div>
        </div>

        <!-- 가게 이미지 -->
        <img th:src="@{/images/restaurant1.jpg}" th:alt="${store.storeName}" class="store-image">

        <!-- 가게 정보 -->
        <div class="store-info">
            <div class="info-header">
                <div class="store-details">
                    <div class="store-name-large" th:text="${store.storeName}">가게명</div>
                    <div class="store-description">맛있는 음식을 제공하는 가게입니다.</div>
                    <div class="rating-section">
                        <span class="stars" th:text="${'★'.repeat(store.rating.intValue()) + '☆'.repeat(5 - store.rating.intValue())}">★★★★☆</span>
                        <span class="rating-text" th:text="${store.rating}">4.5</span>
                        <span class="review-count" th:text="'(' + ${store.reviewCount} + ')'">(24)</span>
                    </div>
                </div>
                <div class="action-buttons">
                    <button class="action-btn">📤</button>
                    <button class="action-btn">🔍</button>
                    <button class="heart-btn">❤️</button>
                    <!-- 가게정보 버튼 추가 -->
                    <a href="#" class="store-info-btn" th:href="@{/api/store/{storeId}/info(storeId=${store.storeId})}" style="display: inline-block; text-decoration: none;">가게정보·원산지</a>
                </div>
            </div>
        </div>

        <!-- 배달 정보 -->
        <div class="delivery-section">
            <div class="delivery-grid">
                <div class="delivery-item">
                    <div class="delivery-label">최소주문</div>
                    <div class="delivery-value" th:text="${'₩' + #numbers.formatInteger(store.minimumPrice, 1, 'COMMA')}">₩10,000</div>
                </div>
                <div class="delivery-item">
                    <div class="delivery-label">배달팁</div>
                    <div class="delivery-value">
                        <span class="delivery-free" th:if="${store.deliveryFee == 0}">무료</span>
                        <span th:if="${store.deliveryFee > 0}" th:text="${'₩' + #numbers.formatInteger(store.deliveryFee, 1, 'COMMA')}">₩0</span>
                    </div>
                </div>
                <div class="delivery-item">
                    <div class="delivery-label">예상시간</div>
                    <div class="delivery-value" th:text="${store.estimatedDeliveryTime}">12~27분</div>
                </div>
            </div>
            <div class="text-center mt-3" th:if="${store.deliveryFee == 0}">
                <span class="delivery-original" th:text="${'₩' + #numbers.formatInteger(store.originalDeliveryFee, 1, 'COMMA')}">₩1,900</span>
                <span class="delivery-free ms-2">무료배달 적용 중</span>
            </div>
        </div>

        <!-- 쿠폰 섹션 -->
        <div class="coupon-section">
            <div class="coupon-content">
                <span class="coupon-text">내가 받은 쿠폰 보기</span>
                <span class="coupon-arrow">></span>
            </div>
        </div>

        <!-- 리뷰 미리보기 -->
        <div class="review-preview">
            <div class="review-header">
                <div class="review-title">리뷰</div>
                <a th:href="@{/api/store/{storeId}/reviews(storeId=${store.storeId})}" class="review-more">리뷰 더보기 ></a>
            </div>
            
            <!-- 최신 리뷰가 있을 때 -->
            <div class="review-item" th:if="${latestReview != null}">
                <div class="review-user-info">
                    <span class="review-username" th:text="${latestReview.userName}">사용자명</span>
                    <span class="review-time" th:text="${latestReview.orderDate}">방금 전</span>
                </div>
                <div class="review-stars">
                    <span th:each="i : ${#numbers.sequence(1, latestReview.rating)}" style="color: #FFD93D;">★</span>
                    <span th:each="i : ${#numbers.sequence(latestReview.rating + 1, 5)}" style="color: #E0E0E0;">☆</span>
                </div>
                <div class="review-content" th:text="${latestReview.content}">리뷰 내용</div>
            </div>
            
            <!-- 리뷰가 없을 때 -->
            <div class="review-item" th:if="${latestReview == null}">
                <div class="no-review">등록된 리뷰가 없습니다.</div>
            </div>
        </div>

        <!-- 메뉴 탭 -->
        <div class="menu-tabs">
            <div class="tab-list">
                <button class="tab-item active" onclick="showMenuTab('popular')">인기 메뉴</button>
                <button class="tab-item" onclick="showMenuTab('main')">메인 메뉴</button>
                <button class="tab-item" onclick="showMenuTab('set')">세트 메뉴</button>
                <button class="tab-item" onclick="showMenuTab('dumpling')">만두 메뉴</button>
            </div>
        </div>

        <!-- 메뉴 리스트 -->
        <div class="menu-section">
            <!-- 인기 메뉴 -->
            <div id="popular" class="menu-tab active">
                <div th:if="${not #lists.isEmpty(popularMenus)}">
                    <div class="menu-card" th:each="menu : ${popularMenus}" th:onclick="'location.href=\'/api/store/' + ${store.storeId} + '/menu/' + ${menu.menuId} + '\''">
                        <div class="menu-content">
                            <div class="menu-info">
                                <div class="menu-badges">
                                    <span class="badge badge-popular" th:if="${menu.isPopular}">인기</span>
                                    <span class="badge badge-recommended" th:if="${menu.isRecommended}">사장님 추천</span>
                                </div>
                                <div class="menu-name" th:text="${menu.menuName}">메뉴명</div>
                                <div class="menu-description" th:text="${menu.description}">메뉴 설명</div>
                                <div class="menu-footer">
                                    <span class="menu-price" th:text="${'₩' + #numbers.formatInteger(menu.price, 1, 'COMMA')}">₩13,900</span>
                                    <span class="menu-review" th:text="${'리뷰 ' + (menu.reviewCount ?: 0)}">리뷰 2</span>
                                </div>
                            </div>
                            <img th:src="@{${menuStat.odd ? '/images/restaurant1.jpg' : '/images/restaurant2.jpg'}}" th:alt="${menu.menuName}" class="menu-image">
                        </div>
                    </div>
                </div>
                <div th:if="${#lists.isEmpty(popularMenus)}" class="empty-menu">
                    <span class="emoji">🍽️</span>
                    <div class="message">인기 메뉴가 없습니다</div>
                </div>
            </div>

            <!-- 메인 메뉴 -->
            <div id="main" class="menu-tab" style="display: none;">
                <div th:if="${not #lists.isEmpty(mainMenus)}">
                    <div class="menu-card" th:each="menu : ${mainMenus}" th:onclick="'location.href=\'/api/store/' + ${store.storeId} + '/menu/' + ${menu.menuId} + '\''">
                        <div class="menu-content">
                            <div class="menu-info">
                                <div class="menu-name" th:text="${menu.menuName}">메뉴명</div>
                                <div class="menu-description" th:text="${menu.description}">메뉴 설명</div>
                                <div class="menu-footer">
                                    <span class="menu-price" th:text="${'₩' + #numbers.formatInteger(menu.price, 1, 'COMMA')}">₩13,900</span>
                                    <span class="menu-review" th:text="${'리뷰 ' + (menu.reviewCount ?: 0)}">리뷰 2</span>
                                </div>
                            </div>
                            <img th:src="@{${menuStat.odd ? '/images/restaurant2.jpg' : '/images/restaurant1.jpg'}}" th:alt="${menu.menuName}" class="menu-image">
                        </div>
                    </div>
                </div>
                <div th:if="${#lists.isEmpty(mainMenus)}" class="empty-menu">
                    <span class="emoji">🍽️</span>
                    <div class="message">메인 메뉴가 없습니다</div>
                </div>
            </div>

            <!-- 세트 메뉴 -->
            <div id="set" class="menu-tab" style="display: none;">
                <div th:if="${not #lists.isEmpty(setMenus)}">
                    <div class="menu-card" th:each="menu : ${setMenus}" th:onclick="'location.href=\'/api/store/' + ${store.storeId} + '/menu/' + ${menu.menuId} + '\''">
                        <div class="menu-content">
                            <div class="menu-info">
                                <div class="menu-name" th:text="${menu.menuName}">메뉴명</div>
                                <div class="menu-description" th:text="${menu.description}">메뉴 설명</div>
                                <div class="menu-footer">
                                    <span class="menu-price" th:text="${'₩' + #numbers.formatInteger(menu.price, 1, 'COMMA')}">₩13,900</span>
                                    <span class="menu-review" th:text="${'리뷰 ' + (menu.reviewCount ?: 0)}">리뷰 2</span>
                                </div>
                            </div>
                            <img th:src="@{${menuStat.odd ? '/images/restaurant1.jpg' : '/images/restaurant2.jpg'}}" th:alt="${menu.menuName}" class="menu-image">
                        </div>
                    </div>
                </div>
                <div th:if="${#lists.isEmpty(setMenus)}" class="empty-menu">
                    <span class="emoji">🍽️</span>
                    <div class="message">세트 메뉴가 없습니다</div>
                </div>
            </div>

            <!-- 만두 메뉴 -->
            <div id="dumpling" class="menu-tab" style="display: none;">
                <div th:if="${not #lists.isEmpty(dumplingMenus)}">
                    <div class="menu-card" th:each="menu : ${dumplingMenus}" th:onclick="'location.href=\'/api/store/' + ${store.storeId} + '/menu/' + ${menu.menuId} + '\''">
                        <div class="menu-content">
                            <div class="menu-info">
                                <div class="menu-name" th:text="${menu.menuName}">메뉴명</div>
                                <div class="menu-description" th:text="${menu.description}">메뉴 설명</div>
                                <div class="menu-footer">
                                    <span class="menu-price" th:text="${'₩' + #numbers.formatInteger(menu.price, 1, 'COMMA')}">₩13,900</span>
                                    <span class="menu-review" th:text="${'리뷰 ' + (menu.reviewCount ?: 0)}">리뷰 2</span>
                                </div>
                            </div>
                            <img th:src="@{${menuStat.odd ? '/images/restaurant2.jpg' : '/images/restaurant1.jpg'}}" th:alt="${menu.menuName}" class="menu-image">
                        </div>
                    </div>
                </div>
                <div th:if="${#lists.isEmpty(dumplingMenus)}" class="empty-menu">
                    <span class="emoji">🍽️</span>
                    <div class="message">만두 메뉴가 없습니다</div>
                </div>
            </div>
        </div>

        <!-- 하단 여백 -->
        <div class="bottom-spacer"></div>
    </div>

    <!-- 장바구니 버튼 -->
    <div class="cart-button" th:if="${cartItemCount > 0}">
        <a href="/cart" class="btn-cart">
            🛒 <span th:text="${cartItemCount}">1</span>개 담기
        </a>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    
    <script th:src="@{/js/store-detail.js}"></script>
</body>
</html> 