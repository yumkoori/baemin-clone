<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>로그인 처리 중...</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        .loading-container {
            text-align: center;
            background: white;
            padding: 40px;
            border-radius: 16px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.1);
        }
        .spinner {
            width: 50px;
            height: 50px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid #00d4aa;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .loading-text {
            font-size: 18px;
            color: #333;
            margin-bottom: 10px;
        }
        .loading-subtext {
            font-size: 14px;
            color: #666;
        }
    </style>
</head>
<body>
    <div class="loading-container">
        <div class="spinner"></div>
        <div class="loading-text">카카오 로그인 처리 중...</div>
        <div class="loading-subtext">잠시만 기다려주세요</div>
    </div>

    <script>
        // 현재 페이지가 OAuth callback 응답인지 확인
        function handleOAuthCallback() {
            try {
                // 페이지 전체 텍스트 확인
                const pageText = document.body.textContent || document.body.innerText;
                
                // JSON 응답인지 확인
                if (pageText.trim().startsWith('{') && pageText.trim().endsWith('}')) {
                    const response = JSON.parse(pageText.trim());
                    
                    if (response.resultCode === 200 && response.data) {
                        // JWT 토큰 저장
                        const jwtToken = response.data;
                        localStorage.setItem('authToken', jwtToken);
                        sessionStorage.setItem('authToken', jwtToken);
                        
                        // 성공 알림과 함께 login.html로 리다이렉트
                        window.location.href = '/html/login.html?token=' + encodeURIComponent(jwtToken);
                        
                    } else {
                        // 에러 처리
                        const errorMessage = response.message || '로그인에 실패했습니다.';
                        window.location.href = '/html/login.html?error=' + encodeURIComponent(errorMessage);
                    }
                } else {
                    // 일반 HTML 페이지인 경우 그대로 진행
                    console.log('일반 HTML 페이지입니다.');
                }
                
            } catch (error) {
                console.error('OAuth 콜백 처리 오류:', error);
                // 에러 발생시 login.html로 리다이렉트
                window.location.href = '/html/login.html?error=' + encodeURIComponent('로그인 처리 중 오류가 발생했습니다.');
            }
        }

        // 페이지 로드 후 OAuth 콜백 처리
        window.addEventListener('load', function() {
            // 약간의 지연 후 처리 (로딩 애니메이션 표시)
            setTimeout(handleOAuthCallback, 1000);
        });
    </script>
</body>
</html> 