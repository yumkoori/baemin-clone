<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>찜 목록 - 배달의민족</title>
    <link rel="stylesheet" th:href="@{/css/favorites.css}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
<!-- 헤더 -->
<header class="header">
    <div class="header-container">
        <div class="header-left">
            <button class="back-btn" onclick="history.back()">←</button>
            <h1 class="page-title">찜</h1>
        </div>
        <div class="header-right">
            <a th:href="@{/api/main}">
                <i class="fas fa-home"></i>
            </a>
        </div>
    </div>
</header>

<!-- 메인 컨텐츠 -->
<main class="main-content">
    <div class="favorites-container">
        <div th:if="${favorites != null and not #lists.isEmpty(favorites.favorites)}">
            <div class="favorites-grid" th:each="favorite : ${favorites.favorites}">
                <div class="favorite-card">
                    <div class="restaurant-image">
                        <img th:src="${favorite.storeImage}" th:alt="${favorite.storeName}" />
                    </div>
                    <div class="restaurant-info">
                        <h3 th:text="${favorite.storeName}">가게명</h3>
                        <div class="restaurant-meta">
                            <span class="rating">
                                <i class="fas fa-star"></i>
                                <span th:text="${favorite.rating}">4.5</span>
                            </span>
                            <span class="review-count" th:text="${'리뷰 ' + favorite.reviewCount}">리뷰 123</span>
                            <span class="delivery-time" th:text="${favorite.deliveryTime}">25-40분</span>
                        </div>
                        <div class="delivery-info">
                            <span class="minimum-order" th:text="${favorite.minimumPrice != null ? '최소주문 ₩' + #numbers.formatInteger(favorite.minimumPrice, 1, 'COMMA') : '최소주문 금액 없음'}">최소주문 ₩10,000</span>
                            <span class="delivery-fee" th:text="${favorite.deliveryFee == 0 ? '무료배달' : '₩' + #numbers.formatInteger(favorite.deliveryFee, 1, 'COMMA')}">무료배달</span>
                        </div>
                    </div>
                    <div class="favorite-actions">
                        <button class="remove-favorite-btn" th:attr="data-favorite-id=${favorite.favoriteId}">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>
        <div th:if="${favorites == null or #lists.isEmpty(favorites.favorites)}" class="empty-favorites">
            <div class="empty-icon">❤️</div>
            <h2>찜한 가게가 없습니다</h2>
            <p>마음에 드는 가게를 찜해보세요!</p>
            <a th:href="@{/api/main}" class="btn-primary">가게 둘러보기</a>
        </div>
    </div>
</main>

<script th:inline="javascript">
    // 찜 해제 기능
    document.addEventListener('DOMContentLoaded', function() {
        const removeButtons = document.querySelectorAll('.remove-favorite-btn');
        removeButtons.forEach(button => {
            button.addEventListener('click', function() {
                const favoriteId = this.getAttribute('data-favorite-id');
                if (confirm('찜 목록에서 삭제하시겠습니까?')) {
                    fetch(`/api/favorites/${favoriteId}`, {
                        method: 'DELETE'
                    })
                    .then(response => {
                        if (response.ok) {
                            // 성공적으로 삭제되면 페이지 새로고침
                            location.reload();
                        } else {
                            alert('찜 목록 삭제에 실패했습니다.');
                        }
                    })
                    .catch(error => {
                        console.error('Error:', error);
                        alert('찜 목록 삭제에 실패했습니다.');
                    });
                }
            });
        });
    });
</script>
</body>
</html>